<?xml version="1.0" encoding="UTF-8"?>
<odoo>
    <data>
        <record id="view_account_move_form_inherit" model="ir.ui.view">
            <field name="name">inherit.invoice.form</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_move_form"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='partner_id']" position="replace">
                    <field name="partner_id" nolabel="1" attrs="{'invisible': [('type', 'not in', ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt'))]}"/>
                    <field name="partner_id" nolabel="1" invisible="type not in ('out_invoice', 'out_refund', 'in_invoice', 'in_refund', 'out_receipt', 'in_receipt')"/>             
                </xpath>
                 <xpath expr="//field[@name='ref']" position="after">
                    <field name="actual_due_date" invisible="1"/>
                    <field name="deviation" invisible="1"/>
                </xpath>
                <xpath expr="//page[@name='other_info']" position="after">
                    <page name="timesheets" string="Timesheets">
                        <group>
                            <group>
                                <field name="project_id"/>
                            </group>
                            <group>
                                <field name="start_date"/>
                                <field name="end_date"/>
                            </group>
                            <field name="rate_employee_timesheet_ids">
                                <tree editable="bottom">
                                    <field name="date" optional="show"/>
                                    <field name="task_id" optional="show"/>
                                    <field name="employee_id" optional="show"/>
                                    <field name="description" optional="show"/>
                                    <field name="unit_amount" optional="show"/>
                                    <field name="rate" optional="show"/>
                                    <field name="total_value" optional="show"/>
                                    <field name="department_id" optional="show"/>
                                    <field name="sales_type" optional="show"/>
                                    <field name="comment" optional="show"/>
                                    <field name="account_move_id" invisible="True"/>
                                </tree>
                            </field>
                            <group>
                                <div class="oe_right oe_button_box">
                                    <button string="Add to invoice" name="set_invoice_line_ids" type="object" context="{'is_tomesheets_context': True}"
                                            class="btn-primary"/>
                                </div>
                                <field name="total_price"/>
                            </group>
                        </group>
                    </page>
                    <page string="Analytics">
                        <group>
                            <field name="department_rate_ids" nolabel="1">
                                <tree editable="bottom" delete="0" create="0">
                                    <field name="department_id" optional="show" readonly="1" force_save="1"/>
                                    <field name="total_hours_dpt" optional="show" readonly="1" force_save="1"/>
                                    <field name="total_department_value" optional="show" readonly="1" force_save="1"/>
                                    <field name="account_move_id" invisible="True" force_save="1"/>
                                    <field name="discounts_by" optional="hide"/>
                                    <field name="disc_percents" optional="show"/>
                                    <field name="with_discount" optional="show" readonly="1" force_save="1"/>
                                    <field name="disc_difference" invisible="1"/>
                                    <field name="number_sales_types_in_dept" invisible="1"/>
                                    <field name="discount_comment" optional="hide" force_save="1"/>
                                </tree>
                            </field>
                        </group>
                        <group>
                            <div class="oe_right oe_button_box">
                                    <button string="Add to invoice" name="set_invoice_line_ids" type="object" context="{'is_tomesheets_context': False}"
                                            class="btn-primary"/>
                                </div>
                            <field name="total_with_discount"/>
                            <field name="split_revenue" invisible="True"/>
                        </group>
                        <group>
                            <group string="Sales Type">
                                <field name="sales_type"/>
                            </group>
                            <group string="Sales Type Revenue">
                                <field name="sales_type_revenue"/>
                            </group>
                        </group>
                        <group>
                            <field name="sales_type_revenue_ids" nolabel="1">
                                <tree editable="bottom">
                                    <field name="sales_type" readonly="1"/>
                                    <field name="sales_type_revenue" readonly="1"/>
                                </tree>
                            </field>
                        </group>
                        <group>
                            <field name="sales_type_departments_ids" nolabel="1" invisible="1">
                                <tree editable="bottom">
                                    <field name="dept_id" readonly="1"/>
                                    <field name="sales_type_by_dept" readonly="1"/>
                                    <field name="sales_revenue_by_dept" readonly="1"/>
                                    <field name="revenue_with_disc" readonly="1"/>
                                </tree>
                            </field>
                        </group>
                    </page>
                    <page string="Analytics (Old Data)" groups="base.group_erp_manager">
                        <group>
                            <field name="x_studio_billing_month"/>
                            <field name="x_studio_billing_year"/>
                            <field name="x_studio_customer_project"/>
                            <field name="x_studio_project"/>
                            <field name="x_studio_project_owner_bl"/>
                            <field name="x_studio_licence_"/>
                            <field name="x_studio_currency"/>
                            <field name="x_studio_company_currency"/>
                        </group>
                        <group>
                            <group string="Departments">
                                <field name="x_studio_department_1_1"/>
                                <field name="x_studio_department_2"/>
                                <field name="x_studio_department_3"/>
                                <field name="x_studio_department_4"/>
                                <field name="x_studio_department_5"/>
                            </group>
                            <group string="Revenue by Department">
                                <field name="x_studio_revenue_1"/>
                                <field name="x_studio_revenue_2"/>
                                <field name="x_studio_revenue_3"/>
                                <field name="x_studio_revenue_4"/>
                                <field name="x_studio_revenue_5"/>
                            </group>
                        </group>
                        <group>
                            <group string="Discounts">
                                <field name="x_studio_discount_1_1"/>
                                <field name="x_studio_discount_2"/>
                                <field name="x_studio_discount_3"/>
                                <field name="x_studio_discount_4"/>
                                <field name="x_studio_discount_5"/>
                            </group>
                            <group string="Comments for Discounts">
                                <field name="x_studio_comment_1"/>
                                <field name="x_studio_comment_2"/>
                                <field name="x_studio_comment_3"/>
                                <field name="x_studio_comment_4"/>
                                <field name="x_studio_comment_5"/>
                            </group>
                        </group>
                        <group>
                            <group string="Sales Type">
                                <field name="x_studio_currentnew"/>
                                <field name="x_studio_sales_type"/>
                                <field name="x_studio_sales_type_2"/>
                                <field name="x_studio_sales_type_3_1"/>
                            </group>
                            <group string="Sales Type Revenue">
                                <field name="x_studio_revenue_currentnew"/>
                                <field name="x_studio_revenue_sales_type_1"/>
                                <field name="x_studio_revenue_sales_type_2"/>
                                <field name="x_studio_revenue_sales_type_3"/>
                            </group>
                        </group>
                    </page>
                </xpath>
                <xpath expr="//field[@name='team_id']" position="after">
                    <field name="billing_month"/>
                    <field name="billing_year"/>
                    <field name="project_owner"/>
                </xpath>
            </field>
        </record>

        <record id="account_move_tree" model="ir.ui.view">
            <field name="name">account.move.inherit.tree</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_invoice_tree"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='company_id']" position="after">
                    <field name="x_studio_currency" optional="show"/>
                    <field name="x_studio_company_currency" optional="show"/>
                    <field name="currency_id" optional="show"/>
                </xpath>
                <xpath expr="//field[@name='amount_total_signed']" position="after">
                    <field name="amount_total" string="Amount total" optional="show"/>
                </xpath>
                 <xpath expr="//field[@name='invoice_date_due']" position="after">
                    <field name="actual_due_date" optional="show"/>
                    <field name="deviation" optional="hide"/>
                </xpath>
            </field>
        </record>

        <record model="ir.ui.view" id="account_move_view_pivot">
            <field name="name">account.move.pivot</field>
            <field name="model">account.move</field>
            <field name="arch" type="xml">
                <pivot string="Account move">
                    <field name="invoice_date"  interval="month" type="col"/>
                    <field name="deviation" type="measure"/>
                </pivot>
            </field>
        </record>

        <record id="view_account_move_inherit" model="ir.ui.view">
            <field name="name">account.move.search.inherit</field>
            <field name="model">account.move</field>
            <field name="inherit_id" ref="account.view_account_invoice_filter"/>
            <field name="arch" type="xml">
                 <xpath expr="//search" position="inside">
                    <filter string="Partner" name="partner" domain="[]" context="{'group_by': 'partner_id'}"/>
                    <filter string="Project owner" name="project_owner" domain="[]" context="{'group_by': 'project_owner'}"/>
                </xpath>
            </field>
        </record>

        <record id="account_move_deviation_action" model="ir.actions.act_window">
            <field name="name">Deviation</field>
            <field name="res_model">account.move</field>
            <field name="type">ir.actions.act_window</field>
            <field name="domain">[('type', '=', 'out_invoice'), ('state', '=', 'posted')]</field>
            <field name="context">{'group_by':['project_owner', 'partner_id']}</field>
            <field name="view_mode">pivot</field>
        </record>

        <menuitem action="account_move_deviation_action" id="deviation_menu"
              parent="account.menu_finance_reports" sequence="12" name="Invoice days deviation"/>

    </data>
</odoo>
